# 快速問題排查指南

## 🚨 監控無法啟動或運行異常

### 步驟 1：啟用 Debug 模式
1. 開啟程式 GUI
2. 勾選 "Debug Mode" 選項
3. 點擊 "Save Config" 儲存

### 步驟 2：測試 API 連線
1. 點擊 "Test API" 按鈕
2. 查看 GUI 下方的歷史記錄
3. 確認 API 端點是否可連線

### 步驟 3：查看 GUI 歷史
查看 GUI 視窗下方的「通知歷史」區域，應該會看到：
- `[INFO] 開始按鈕被點擊`
- `[INFO] 監控已啟動 - 專案: xxx, 間隔: 5 秒`
- `[DEBUG] 監控迴圈已啟動`
- `[DEBUG] API 請求: GET http://...`

如果沒看到這些訊息，表示監控迴圈沒有正常啟動。

### 步驟 4：查看日誌檔案
```bash
# Windows（在 PowerShell）
Get-Content logs\app_$(Get-Date -Format yyyy-MM-dd).log -Tail 50

# Linux/macOS
tail -50 logs/app_$(date +%Y-%m-%d).log
```

### 步驟 5：分析常見錯誤

#### 錯誤 1：API 連線失敗
日誌顯示：
```
[ERROR] API 請求失敗 (XXXms): Get "http://...": dial tcp: connect: connection refused
```
**解決方法**：
- 確認 API 伺服器正在運行
- 檢查 Domain 設定是否正確
- 檢查防火牆設定

#### 錯誤 2：API 回應錯誤
日誌顯示：
```
[ERROR] API 回應錯誤: HTTP 404 (XXXms)
```
**解決方法**：
- 確認 API 端點路徑正確
- 檢查 API 版本是否匹配

#### 錯誤 3：專案名稱錯誤
日誌顯示：
```
[DEBUG] API 回應: HTTP 200 (XXXms) | 數量: 0 | 成功: true
[DEBUG] 沒有未通知的記錄
```
**解決方法**：
- 確認專案名稱拼寫正確
- 確認 API 中有該專案的未通知記錄

#### 錯誤 4：通知推送失敗
日誌顯示：
```
[ERROR] 顯示 Windows 通知失敗: XXX
```
**解決方法**：
- 確認 Windows 通知設定已開啟
- 檢查是否安裝了必要的系統元件

#### 錯誤 5：監控迴圈沒有執行
GUI 顯示「監控已啟動」但沒有後續的 DEBUG 訊息

**解決方法**：
- 重啟程式
- 查看日誌檔案是否有 panic 或 goroutine 錯誤
- 確認間隔時間設定合理（建議 5-60 秒）

## 📊 正常運行的日誌範例

```
[2025-11-03 14:30:15] [INFO] === 應用程式啟動 ===
[2025-11-03 14:30:15] [INFO] 日誌文件: logs/app_2025-11-03.log
[2025-11-03 14:30:15] [INFO] Debug 模式: true
[2025-11-03 14:30:15] [INFO] 應用程式視窗已開啟
[2025-11-03 14:30:20] [INFO] 開始按鈕被點擊
[2025-11-03 14:30:20] [INFO] 監控已啟動 - 專案: free_youtube, 間隔: 5 秒
[2025-11-03 14:30:20] [INFO] API 端點: http://localhost:9204
[2025-11-03 14:30:20] [DEBUG] Debug 模式已開啟 - 將顯示詳細的 API 資訊
[2025-11-03 14:30:20] [DEBUG] 監控迴圈已啟動
[2025-11-03 14:30:20] [DEBUG] 執行首次通知檢查...
[2025-11-03 14:30:20] [DEBUG] API 請求: GET http://localhost:9204/api/notifications?status=0&project=free_youtube
[2025-11-03 14:30:20] [DEBUG] API 回應: HTTP 200 (125ms) | 數量: 2 | 成功: true
[2025-11-03 14:30:20] [INFO] 發現 2 個未通知的記錄
[2025-11-03 14:30:20] [DEBUG] 準備顯示通知: 標題='測試通知', 訊息='這是測試訊息'
[2025-11-03 14:30:20] [DEBUG] Windows 通知已成功推送
[2025-11-03 14:30:20] [DEBUG] API 請求: PATCH http://localhost:9204/api/notifications/123/status | Body: {"status":1}
[2025-11-03 14:30:20] [DEBUG] API 回應: HTTP 200 (45ms) | 成功: true | 訊息: 更新成功
[2025-11-03 14:30:20] [SUCCESS] 已通知: 測試通知 - 這是測試訊息
[2025-11-03 14:30:25] [DEBUG] 定時器觸發，執行通知檢查...
[2025-11-03 14:30:25] [DEBUG] API 請求: GET http://localhost:9204/api/notifications?status=0&project=free_youtube
[2025-11-03 14:30:25] [DEBUG] API 回應: HTTP 200 (98ms) | 數量: 0 | 成功: true
[2025-11-03 14:30:25] [DEBUG] 沒有未通知的記錄
```

## 🔍 關鍵訊息說明

| 日誌訊息 | 說明 | 正常狀態 |
|---------|------|---------|
| `應用程式啟動` | 程式已啟動 | 應該出現 |
| `監控已啟動` | 監控迴圈開始 | 點擊開始後應出現 |
| `監控迴圈已啟動` | 背景執行緒已建立 | 開始監控後應出現 |
| `執行首次通知檢查` | 立即檢查一次 | 開始後立即出現 |
| `API 請求: GET` | 正在查詢 API | 每個間隔應出現 |
| `API 回應: HTTP 200` | API 回應成功 | 每次請求後應出現 |
| `定時器觸發` | 間隔時間到了 | 每 N 秒出現一次 |

## 💡 提示

1. **定期清理日誌**：日誌檔案會累積，建議定期清理舊的日誌檔案
2. **合理設定間隔**：太短的間隔（<3秒）可能造成 API 壓力
3. **保持 Debug 模式開啟**：在開發/測試階段建議保持開啟
4. **檢查磁碟空間**：確保有足夠空間寫入日誌

## 📮 回報問題時請提供

1. 完整的日誌檔案（`logs/app_YYYY-MM-DD.log`）
2. 設定檔內容（`config.json`）
3. 問題發生的時間點
4. GUI 視窗截圖
5. 系統環境（Windows 版本）
